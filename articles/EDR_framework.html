<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ecoregime">
<title>Ecological Dynamic Regime framework • ecoregime</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ecological Dynamic Regime framework">
<meta property="og:description" content="ecoregime">
<meta property="og:image" content="https://mspinillos.github.io/ecoregime/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ecoregime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/EDR_framework.html">Ecological Dynamic Regime framework</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/MSPinillos/ecoregime/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Ecological Dynamic Regime framework</h1>
                        <h4 data-toc-skip class="author">Martina
Sánchez-Pinillos</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MSPinillos/ecoregime/blob/HEAD/vignettes/EDR_framework.Rmd" class="external-link"><code>vignettes/EDR_framework.Rmd</code></a></small>
      <div class="d-none name"><code>EDR_framework.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level3">
<h3 id="ecological-dynamic-regimes-and-the-edr-framework">1.1. Ecological Dynamic Regimes and the EDR framework<a class="anchor" aria-label="anchor" href="#ecological-dynamic-regimes-and-the-edr-framework"></a>
</h3>
<p>An <strong>Ecological Dynamic Regime (EDR)</strong> is defined as the
<em>“fluctuations of ecosystem states around some trend or average
resulting from an intricate mix of internal processes and external
forces that, in the absence of perturbations, keep the system within
specific domains of attraction”</em> (Sánchez-Pinillos et al.,
2023).</p>
<p>EDRs are composed of multiple ecological trajectories showing similar
processes in the development, interaction, and reorganization of some
state variables over time. Thus, <strong>ecological
trajectories</strong> are the essential units of EDRs and can be defined
as sequences of observations capturing the temporal changes of some
state variables. Usually, ecological trajectories are defined based on
multiple state variables (e.g., species, functional traits, land uses)
that make challenging the characterization and comparison of EDRs.</p>
<p>The <strong>EDR framework</strong> is a set of algorithms and metrics
aiming to characterize and compare EDRs composed of ecological
trajectories in multidimensional state spaces. You can find more
information in the following publication, including the formal
definition of the EDR concept, the methodological details of the
framework, and some illustrative examples with artificial and real data
sets:</p>
<ul>
<li>Sánchez-Pinillos M., Kéfi, S., De Cáceres, M., Dakos, V. 2023.
Ecological Dynamic Regimes: Identification, characterization, and
comparison. <em>Ecological Monographs</em>. <a href="https://doi.org/10.1002/ecm.1589" class="external-link uri">https://doi.org/10.1002/ecm.1589</a>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="about-this-vignette">1.2. About this vignette<a class="anchor" aria-label="anchor" href="#about-this-vignette"></a>
</h3>
<p>This vignette aims to give you an overview of the EDR framework and
its implementation in <code>ecoregime</code> to characterize and compare
EDRs.</p>
<p>You can install <code>ecoregime</code> directly from CRAN or from my
GitHub account (development version):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("ecoregime")</span></span>
<span><span class="co"># devtools::install_github(repo = "MSPinillos/ecoregime", dependencies = T, build_vignettes = T)</span></span></code></pre></div>
<p>Once you have installed <code>ecoregime</code> you will have to load
it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mspinillos.github.io/ecoregime/">ecoregime</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"ecoregime"</span><span class="op">)</span></span>
<span><span class="co">#&gt; To cite 'ecoregime' in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Sánchez-Pinillos M, Kéfi S, De Cáceres M, Dakos V (2023). "Ecological</span></span>
<span><span class="co">#&gt;   dynamic regimes: Identification, characterization, and comparison."</span></span>
<span><span class="co">#&gt;   _Ecological Monographs_. &lt;https://doi.org/10.1002/ecm.1589&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Sánchez-Pinillos M (2023). _ecoregime: Analysis of Ecological Dynamic</span></span>
<span><span class="co">#&gt;   Regimes_. &lt;https://doi.org/10.5281/zenodo.7584943&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To see these entries in BibTeX format, use 'print(&lt;citation&gt;,</span></span>
<span><span class="co">#&gt; bibtex=TRUE)', 'toBibtex(.)', or set</span></span>
<span><span class="co">#&gt; 'options(citation.bibtex.max=999)'.</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="trajectory-data-state-and-trajectory-spaces">2. Trajectory data, state and trajectory spaces<a class="anchor" aria-label="anchor" href="#trajectory-data-state-and-trajectory-spaces"></a>
</h2>
<p>If you are familiar with ecological trajectories defined in
multivariate spaces, you can probably skip this section. Otherwise, I
recommend you to read on.</p>
<p>Let me define a simple example that I will use along this vignette.
Imagine that we have 10 sampling units in which we are monitoring the
temporal changes in some state variables. For example, those sampling
units (<em>A, B, …, J</em>) could be permanent plots or transects in
which we have inventoried the abundance of two species (<em>sp1,
sp2</em>) at three temporal points (<em>t</em> = 1, <em>t</em> = 2,
<em>t</em> = 3).</p>
<p>I will use the Lotka-Volterra model to generate some artificial data
and illustrate our example. I will define the parameters of the model to
generate trajectories leading to the competitive exclusion of
<em>sp2</em> by <em>sp1</em> regardless of the initial state. As such,
all sampling units will have analogous trajectories that can be
considered part of the same EDR.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ID of the sampling units and observations</span></span>
<span><span class="va">ID_sampling</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span>
<span><span class="va">ID_obs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span></span>
<span><span class="co"># Define initial species abundances</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sampling_units <span class="op">=</span> <span class="va">ID_sampling</span>, </span>
<span>                   sp1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>, </span>
<span>                   sp2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the parameters for the Lotka-Volterra model</span></span>
<span><span class="va">parms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r1 <span class="op">=</span> <span class="fl">1</span>, r2 <span class="op">=</span> <span class="fl">0.1</span>, a11 <span class="op">=</span> <span class="fl">0.02</span>, a21 <span class="op">=</span> <span class="fl">0.03</span>, a22 <span class="op">=</span> <span class="fl">0.02</span>, a12 <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can use primer and deSolve to run the simulations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">primer</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: deSolve</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="va">simulated_abun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">initial</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">isampling</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Initial abundance in the sampling unit i</span></span>
<span>  <span class="va">initialN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial</span><span class="op">$</span><span class="va">sp1</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, <span class="va">initial</span><span class="op">$</span><span class="va">sp2</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Simulate community dynamics</span></span>
<span>  <span class="va">simulated_abun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">initialN</span>, times <span class="op">=</span> <span class="va">ID_obs</span>, func <span class="op">=</span> <span class="va">lvcomp2</span>, parms <span class="op">=</span> <span class="va">parms</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Add the names of the sampling units</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">&lt;-</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span></span>
<span>  <span class="co"># Calculate relative abundances</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sampling_unit"</span>, <span class="st">"time"</span>, <span class="st">"sp1"</span>, <span class="st">"sp2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile species abundances of all sampling units in the same data frame</span></span>
<span><span class="va">abundance</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulated_abun</span><span class="op">)</span></span></code></pre></div>
<p>We obtain an abundance matrix similar to what we could get from field
data. For each sampling unit (<code>sampling_unit</code>) and
observation (<code>time</code>), we know the relative abundance of two
species (<code>sp1</code> and <code>sp2</code>).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span></span>
<span><span class="co">#&gt;   sampling_unit time       sp1        sp2</span></span>
<span><span class="co">#&gt; 1             A    1 0.2320000 0.76800000</span></span>
<span><span class="co">#&gt; 2             A    2 0.4222631 0.57773693</span></span>
<span><span class="co">#&gt; 3             A    3 0.6354107 0.36458929</span></span>
<span><span class="co">#&gt; 4             B    1 0.6370968 0.36290323</span></span>
<span><span class="co">#&gt; 5             B    2 0.8078814 0.19211857</span></span>
<span><span class="co">#&gt; 6             B    3 0.9066680 0.09333198</span></span></code></pre></div>
<p>Next, we need to define the <strong>state space</strong> in which
ecological trajectories live. The state space is a multidimensional
resemblance space defined by the dissimilarities between every pair of
states (the observations) in terms of some state variables (the
species). That is, we need to generate a matrix (<strong><span class="math inline">\(D_O\)</span></strong>) representing the state
space and containing the dissimilarities between the observations of all
sampling units.</p>
<p>The choice of the dissimilarity metric used to generate <strong><span class="math inline">\(D_O\)</span></strong> depends on the
characteristics of your data and the nature of the variables. Your
decision should be made carefully since it will affect the analyses in
the EDR framework. In our example, we are using species abundances. A
common dissimilarity metric adequate for that is the percentage
difference (a.k.a. Bray-Curtis index). However, if you have
presence/absence data, you could prefer the Jaccard’s distance, and if
your state variables are categorical (e.g., functional traits), you
should use a multi-trait dissimilarity (e.g., the Gower distance).</p>
<p>In our example, we will use <code>vegan</code> to calculate
Bray-Curtis dissimilarities and generate <strong><span class="math inline">\(D_O\)</span></strong>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Generate a matrix containing dissimilarities between states</span></span>
<span><span class="va">state_dissim</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span><span class="op">)</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">state_dissim</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;           1         2           3           4          5          6</span></span>
<span><span class="co">#&gt; 1 0.0000000 0.1902631 0.403410706 0.405096774 0.57588143 0.67466802</span></span>
<span><span class="co">#&gt; 2 0.1902631 0.0000000 0.213147639 0.214833707 0.38561836 0.48440495</span></span>
<span><span class="co">#&gt; 3 0.4034107 0.2131476 0.000000000 0.001686068 0.17247072 0.27125731</span></span>
<span><span class="co">#&gt; 4 0.4050968 0.2148337 0.001686068 0.000000000 0.17078465 0.26957124</span></span>
<span><span class="co">#&gt; 5 0.5758814 0.3856184 0.172470722 0.170784654 0.00000000 0.09878659</span></span>
<span><span class="co">#&gt; 6 0.6746680 0.4844050 0.271257312 0.269571243 0.09878659 0.00000000</span></span></code></pre></div>
<p>We can visualize the state space using ordination methods. Here, I
apply multidimensional scaling (mMDS; <code>smacof</code>) to the
dissimilarity matrix <strong><span class="math inline">\(D_O\)</span></strong> and plot the distribution of
the ecological states in an ordination space. We will use different
colors and the code of the sampling unit to represent the observations
of each sampling unit:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multidimensional scaling</span></span>
<span><span class="va">state_mds</span> <span class="op">&lt;-</span> <span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/smacofSym.html" class="external-link">smacofSym</a></span><span class="op">(</span><span class="va">state_dissim</span>, ndim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">state_mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">$</span><span class="va">conf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define different colors for each trajectory</span></span>
<span><span class="va">traj.colors</span> <span class="op">&lt;-</span> <span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">10</span>, <span class="st">"Paired"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the distribution of the states in the state space</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">$</span><span class="va">D1</span>, <span class="va">state_mds</span><span class="op">$</span><span class="va">D2</span>,</span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">traj.colors</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># use different colors for each sampling unit</span></span>
<span>     pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># use different symbols for each sampling unit</span></span>
<span>     xlab <span class="op">=</span> <span class="st">"Axis 1"</span>, ylab <span class="op">=</span> <span class="st">"Axis 2"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"State space"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/state_mds-1.png" width="480" style="display: block; margin: auto;"></p>
<p>To see how ecological trajectories are distributed in the state
space, we just need to link the states of each sampling unit in
chronological order.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">## --&gt;&gt; This code shows you the process step by step. You could directly use </span></span>
<span><span class="co">## --&gt;&gt; ecotraj::trajectoryPlot()</span></span>
<span></span>
<span><span class="co"># Plot the distribution of the states in the state space</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">$</span><span class="va">D1</span>, <span class="va">state_mds</span><span class="op">$</span><span class="va">D2</span>,</span>
<span>     col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">traj.colors</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># use different colors for each sampling unit</span></span>
<span>     pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="co"># use different symbols for each sampling unit</span></span>
<span>     xlab <span class="op">=</span> <span class="st">"Axis 1"</span>, ylab <span class="op">=</span> <span class="st">"Axis 2"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"State space"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Link trajectory states in chronological order</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">isampling</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">30</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># From observation 1 to observation 2</span></span>
<span>  <span class="fu">shape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shape/man/Arrows.html" class="external-link">Arrows</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         col <span class="op">=</span> <span class="va">traj.colors</span><span class="op">[</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">isampling</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">]</span>, arr.adj <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># From observation 2 to observation 3</span></span>
<span>  <span class="fu">shape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shape/man/Arrows.html" class="external-link">Arrows</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">state_mds</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         col <span class="op">=</span> <span class="va">traj.colors</span><span class="op">[</span><span class="fl">1</span><span class="op">+</span><span class="op">(</span><span class="va">isampling</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fl">3</span><span class="op">]</span>, arr.adj <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/traj_state_mds-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The <strong>trajectory space</strong> is a multidimensional space
defined by the dissimilarities between trajectories (i.e., the whole
sequence of states for each sampling unit). Analogously to the state
space, you need to generate a dissimilarity matrix (<strong><span class="math inline">\(D_T\)</span></strong>) and the metric that you use
will affect the subsequent analyses. Although there are multiple
metrics, there are no formal analyses evaluating their performance in
ecological applications. Here, I suggest the directed segment path
dissimilarity (De Cáceres et al., 2019, <em>Ecol. Monogr.</em>, <a href="https://doi.org/10.1002/ecm.1350" class="external-link uri">https://doi.org/10.1002/ecm.1350</a>), but you could use any
other dissimilarity metric.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Generate a matrix containing dissimilarities between trajectories</span></span>
<span><span class="va">traj_dissim</span> <span class="op">&lt;-</span> <span class="fu">ecotraj</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/ecotraj/reference/trajectorymetrics.html" class="external-link">trajectoryDistances</a></span><span class="op">(</span><span class="va">state_dissim</span>, </span>
<span>                                            sites <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                                            surveys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>, distance.type <span class="op">=</span> <span class="st">"DSPD"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">traj_dissim</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span></span>
<span><span class="co">#&gt;           A          B         C          D         E         F</span></span>
<span><span class="co">#&gt; A 0.0000000 0.30509564 0.1084426 0.27711311 0.5425424 0.2600516</span></span>
<span><span class="co">#&gt; B 0.3050956 0.00000000 0.1409823 0.02576483 0.1520544 0.6244592</span></span>
<span><span class="co">#&gt; C 0.1084426 0.14098231 0.0000000 0.11299979 0.3784291 0.4231264</span></span>
<span><span class="co">#&gt; D 0.2771131 0.02576483 0.1129998 0.00000000 0.1756016 0.6031298</span></span>
<span><span class="co">#&gt; E 0.5425424 0.15205442 0.3784291 0.17560156 0.0000000 0.8146293</span></span>
<span><span class="co">#&gt; F 0.2600516 0.62445921 0.4231264 0.60312977 0.8146293 0.0000000</span></span></code></pre></div>
<p>In contrast to the state space, in the trajectory space, each
trajectory is represented by one point:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multidimensional scaling</span></span>
<span><span class="va">traj_mds</span> <span class="op">&lt;-</span> <span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/smacofSym.html" class="external-link">smacofSym</a></span><span class="op">(</span><span class="va">traj_dissim</span>, ndim <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">traj_mds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">traj_mds</span><span class="op">$</span><span class="va">conf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the distribution of the trajectories in the trajectory space</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">traj_mds</span><span class="op">$</span><span class="va">D1</span>, <span class="va">traj_mds</span><span class="op">$</span><span class="va">D2</span>,</span>
<span>     col <span class="op">=</span> <span class="va">traj.colors</span>, <span class="co"># use different colors for each sampling unit</span></span>
<span>     pch <span class="op">=</span> <span class="va">ID_sampling</span>, <span class="co"># use different symbols for each sampling unit</span></span>
<span>     xlab <span class="op">=</span> <span class="st">"Axis 1"</span>, ylab <span class="op">=</span> <span class="st">"Axis 2"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Trajectory space"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/traj_mds-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="defining-edrs">3. Defining EDRs<a class="anchor" aria-label="anchor" href="#defining-edrs"></a>
</h2>
<div class="section level3">
<h3 id="identifying-edrs-from-clustering-analyses">3.1. Identifying EDRs from clustering analyses<a class="anchor" aria-label="anchor" href="#identifying-edrs-from-clustering-analyses"></a>
</h3>
<p>Identifying EDRs involves finding groups of ecological trajectories
showing dynamic patterns more similar between each other than with any
other ecological trajectory in the trajectory space. In this sense, it
is possible to use the trajectory dissimilarity matrix (<strong><span class="math inline">\(D_T\)</span></strong>) to identify EDRs through
clustering. However, applying clustering analyses to trajectory data is
not always straightforward. Depending on the characteristics of your
data, your goals, and the system that you are evaluating, the choice of
the clustering algorithm may have important consequences.</p>
<p>Currently, this is out of the scope of <code>ecoregime</code> but you
can find more details in the paper introducing the EDR framework
(Sánchez-Pinillos et al., 2023)</p>
</div>
<div class="section level3">
<h3 id="defining-edrs-based-on-ecological-properties">3.2. Defining EDRs based on ecological properties<a class="anchor" aria-label="anchor" href="#defining-edrs-based-on-ecological-properties"></a>
</h3>
<p>Clustering analyses are not the only way to define EDRs. As I stated
before, the ecological trajectories of our simulated data can be
considered part of the same EDR for having similar dynamic patterns.
Thus, you could define groups of trajectories that you want to evaluate
for sharing similar aspects in the state variables. For example, you
could consider groups of trajectories with the same number of
observations in which the state variables change following similar
patterns.</p>
</div>
</div>
<div class="section level2">
<h2 id="representative-trajectories">4. Representative trajectories<a class="anchor" aria-label="anchor" href="#representative-trajectories"></a>
</h2>
<p>Regardless of the method used to define EDRs, you can use
<code>ecoregime</code> to summarize their dynamics. In our example, it
is easy to identify a clear pattern of competitive exclusion of
<em>sp2</em> by <em>sp1</em>. We can simply plot the changes in species
abundances over time to see this pattern:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot species abundances over time</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">time</span>, <span class="va">abundance</span><span class="op">$</span><span class="va">sp1</span>, type <span class="op">=</span> <span class="st">"n"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.01</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Observation"</span>, ylab <span class="op">=</span> <span class="st">"Species abundance"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Temporal variation in species composition"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">ID_sampling</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">time</span>,</span>
<span>         <span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">sp1</span>,</span>
<span>         col <span class="op">=</span> <span class="va">traj.colors</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, pch <span class="op">=</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">time</span>,</span>
<span>         <span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">sp1</span>,</span>
<span>         col <span class="op">=</span> <span class="st">"black"</span>, pch <span class="op">=</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">time</span>,</span>
<span>         <span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">sp2</span>,</span>
<span>         col <span class="op">=</span> <span class="va">traj.colors</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, pch <span class="op">=</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">time</span>,</span>
<span>         <span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">==</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">sp2</span>,</span>
<span>         col <span class="op">=</span> <span class="st">"red"</span>, pch <span class="op">=</span> <span class="va">ID_sampling</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, bg <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/sp_variation-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Or we can test the correlations between the first axis of the state
space and the species abundances along the trajectories.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Correlation of the first axis of the state space with the abundance of sp1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">$</span><span class="va">D1</span>, <span class="va">abundance</span><span class="op">$</span><span class="va">sp1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># Correlation of the first axis of the state space with the abundance of sp2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">state_mds</span><span class="op">$</span><span class="va">D1</span>, <span class="va">abundance</span><span class="op">$</span><span class="va">sp2</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -1</span></span></code></pre></div>
<p>These analyses are fine for extremely simple systems as the one
simulated in our toy data. However, when we want to apply these or
similar approaches to empirical data, finding clear dynamical patterns
becomes more difficult. In real ecosystems, we usually have to deal with
a great heterogeneity, multiple variables interacting between each
other, and noise. As a consequence, we need robust tools able to
summarize a great variety of trajectories in multidimensional spaces.
That is precisely what RETRA-EDR pursues.</p>
<div class="section level3">
<h3 id="identifying-representative-trajectories-with-retra-edr">4.1. Identifying representative trajectories with RETRA-EDR<a class="anchor" aria-label="anchor" href="#identifying-representative-trajectories-with-retra-edr"></a>
</h3>
<p><strong>RETRA-EDR (REpresentative TRAjectories in Ecological Dynamic
Regimes)</strong> is an algorithm that aims to identify representative
trajectories in EDRs based on the distribution and density of their
ecological trajectories (Sánchez-Pinillos et al., 2023). Whereas many
algorithms with similar goals where developed for moving objects in
low-dimensional spaces, RETRA-EDR can be applied to high-dimensional
spaces, capturing the complexity of empirical data.</p>
<p>I will not explain the details of RETRA-EDR in this vignette (you can
find them in Sánchez-Pinillos et al., 2023), but it is important that
you know its main steps to understand the output returned by
<code><a href="../reference/retra_edr.html">retra_edr()</a></code>:</p>
<ol style="list-style-type: decimal">
<li>The ecological trajectories forming the EDR are split into segments.
Then, a <strong>segment space</strong> analogous to the trajectory space
is generated from a matrix containing segment dissimilarities.</li>
<li>The segment space is divided into regions with a minimum number of
trajectory segments (<code>minSegs</code>). For that, RETRA-EDR
recursively divides the space into halves following the axes of the
segment space and generating a <strong>kd-tree structure</strong>. The
greater the density of segments in a particular region, the larger the
number of partitions required until obtaining regions with
<code>minSegs</code> segments. The number of partitions is known as the
<em>depth</em> of the <em>k</em>d-tree (<code>kdTree_depth</code>) and
the number of segments in the final region is the
<code>Density</code>.</li>
<li>For each region with at least <code>minSegs</code> segments,
RETRA-EDR extracts the medoid as the <strong>representative
segment</strong>.</li>
<li>All representative segments are joined forming a network of
<strong>representative trajectories</strong>.</li>
<li>RETRA-EDR returns a set of <strong>attributes characterizing the
representative trajectories</strong> identified in the EDR, including
the value of <code>minSegs</code>; the sequence of representative
segments (<code>Segments</code>) and the number of states
(<code>Size</code>) forming each representative trajectory; the total
length of the trajectory (<code>Length</code>); the links
(<code>Link</code>) generated to join representative segments and the
dissimilarity between the connected states (<code>Distance</code>); the
number of segments in each region represented by each representative
segment (<code>Density</code>), and the number of partitions of the
segment space until obtaining a region with <code>minSegs</code>
segments or less (<code>kdTree_depth</code>).</li>
</ol>
<p>Let’s apply <code><a href="../reference/retra_edr.html">retra_edr()</a></code> to our data. As the EDR only
contains 10 trajectories, we will assign a value of <code>minSegs</code>
relatively low.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Use set.seed to obtain reproducible results of the segment space in RETRA-EDR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Apply RETRA-EDR</span></span>
<span><span class="va">repr_traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/retra_edr.html">retra_edr</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">state_dissim</span>, trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>,</span>
<span>                   states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>, minSegs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>RETRA-EDR has returned two representative trajectories. We can
summarize their attributes using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">repr_traj</span><span class="op">)</span></span>
<span><span class="co">#&gt;    ID Size    Length   Avg_link   Sum_link Avg_density Max_density Avg_depth</span></span>
<span><span class="co">#&gt; T1 T1    6 0.3577606 0.02996245 0.05992491           3           3  3.666667</span></span>
<span><span class="co">#&gt; T2 T2    7 0.6048257 0.03925918 0.07851836           3           3  3.500000</span></span>
<span><span class="co">#&gt;    Max_depth</span></span>
<span><span class="co">#&gt; T1         4</span></span>
<span><span class="co">#&gt; T2         4</span></span></code></pre></div>
<p>The output of <code><a href="../reference/retra_edr.html">retra_edr()</a></code> is an object of class
<code>RETRA</code>. We can extract specific attributes as we do with
lists.</p>
<p><code>Segments</code> is probably the most important attribute since
it informs about the states that form the representative
trajectories.</p>
<ul>
<li>
<em>T1</em> is composed of six states of three different
trajectories (<em>B</em>, <em>I</em>, and <em>E</em>).</li>
<li>
<em>T2</em> is composed of the three states of the sampling unit
<em>C</em> and converges towards <em>T1</em> through a link between the
last state of <em>C</em> and the second state of <em>I</em>.</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">repr_traj</span>, <span class="st">"[["</span>, <span class="st">"Segments"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $T1</span></span>
<span><span class="co">#&gt; [1] "B[1-2]" "I[2-3]" "E[2-3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $T2</span></span>
<span><span class="co">#&gt; [1] "C[1-2]" "C[2-3]" "I[2-3]" "E[2-3]"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualizing-representative-trajectories-in-the-state-space">4.2. Visualizing representative trajectories in the state space<a class="anchor" aria-label="anchor" href="#visualizing-representative-trajectories-in-the-state-space"></a>
</h3>
<p>We can also visualize the representative trajectories in the state
space using the function <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the representative trajectories of an EDR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">repr_traj</span>, <span class="co"># &lt;-- This is a RETRA object returned by retra_edr()</span></span>
<span>     <span class="co"># data to generate the state space</span></span>
<span>     d <span class="op">=</span> <span class="va">state_mds</span>, trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>     <span class="co"># use the colors previously used for individual trajectories. </span></span>
<span>     <span class="co"># (make them more transparent to highlight representative trajectories)</span></span>
<span>     traj.colors <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/alpha.html" class="external-link">alpha</a></span><span class="op">(</span><span class="va">traj.colors</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>     <span class="co"># display representative trajectories in blue    </span></span>
<span>     RT.colors <span class="op">=</span> <span class="st">"blue"</span>,</span>
<span>     <span class="co"># select T2 to be displayed with a different color (black)</span></span>
<span>     select_RT <span class="op">=</span> <span class="st">"T2"</span>, sel.color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>     <span class="co"># Identify artificial links using dashed lines (default) and a different color (red)</span></span>
<span>     link.lty <span class="op">=</span> <span class="fl">2</span>, link.color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     <span class="co"># We can use other arguments in plot()</span></span>
<span>     main <span class="op">=</span> <span class="st">"Representative trajectories"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span>, <span class="st">"Link"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/plot_retra-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="defining-representative-trajectories-based-on-trajectory-features">4.3. Defining representative trajectories based on trajectory
features<a class="anchor" aria-label="anchor" href="#defining-representative-trajectories-based-on-trajectory-features"></a>
</h3>
<p>RETRA-EDR returns the longest possible trajectory according to the
procedure defined before. However, you could be interested in only a
fraction of a representative trajectory, split representative
trajectories based on some criteria (e.g. long artificial links), or
maybe, define your own representative trajectory.</p>
<p>Let’s say that we want to split <em>T1</em> and <em>T2</em> from the
last segment (<code>"E[2-3]"</code>). For that, we can use the function
<code><a href="../reference/define_retra.html">define_retra()</a></code>.</p>
<p>There are two ways of defining our “new” trajectories. The first one
consists in providing all the details in a data frame:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Generate a data frame indicating the states forming the new trajectories</span></span>
<span><span class="va">new_traj_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  <span class="co"># name of the new trajectories (as many times as the number of states)</span></span>
<span>  RT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T1.1"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T2.1"</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T1.2"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># name of the trajectories (sampling units)</span></span>
<span>  RT_traj <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"B"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># for the first trajectory (T1.1)</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># for the second trajectory (T2.1)</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"E"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="co"># for the third trajectory (T1.2)</span></span>
<span>  <span class="co"># states in each sampling unit </span></span>
<span>  RT_states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="co"># for the first trajectory (T1.1)</span></span>
<span>                <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="co"># for the second trajectory (T2.1)</span></span>
<span>                <span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="co"># for the third trajectory (T1.2)</span></span>
<span>  <span class="co"># representative trajectories obtained in retra_edr()</span></span>
<span>  RT_retra <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T2"</span>, <span class="fl">5</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="co"># The last segment belong to both (T1, T2), choose one</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_traj_df</span></span>
<span><span class="co">#&gt;      RT RT_traj RT_states RT_retra</span></span>
<span><span class="co">#&gt; 1  T1.1       B         1       T1</span></span>
<span><span class="co">#&gt; 2  T1.1       B         2       T1</span></span>
<span><span class="co">#&gt; 3  T1.1       I         2       T1</span></span>
<span><span class="co">#&gt; 4  T1.1       I         3       T1</span></span>
<span><span class="co">#&gt; 5  T2.1       C         1       T2</span></span>
<span><span class="co">#&gt; 6  T2.1       C         2       T2</span></span>
<span><span class="co">#&gt; 7  T2.1       C         3       T2</span></span>
<span><span class="co">#&gt; 8  T2.1       I         2       T2</span></span>
<span><span class="co">#&gt; 9  T2.1       I         3       T2</span></span>
<span><span class="co">#&gt; 10 T1.2       E         2       T1</span></span>
<span><span class="co">#&gt; 11 T1.2       E         3       T1</span></span></code></pre></div>
<p>The second one consists in providing a list with the sequences of
segments defining each trajectory. This is particularly useful when we
want to select a subset in the output of RETRA-EDR:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># List including the sequence of segments for each new trajectory</span></span>
<span><span class="va">new_traj_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="co"># First part of T1 excluding the last segment</span></span>
<span>  <span class="va">repr_traj</span><span class="op">$</span><span class="va">T1</span><span class="op">$</span><span class="va">Segments</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">repr_traj</span><span class="op">$</span><span class="va">T1</span><span class="op">$</span><span class="va">Segments</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="co"># First part of T2 excluding the last segment</span></span>
<span>  <span class="va">repr_traj</span><span class="op">$</span><span class="va">T2</span><span class="op">$</span><span class="va">Segments</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">repr_traj</span><span class="op">$</span><span class="va">T2</span><span class="op">$</span><span class="va">Segments</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  <span class="co"># Last segment of T1 and T2: segment composed of states 2 and 3 of the sampling unit E ("E[2-3]")</span></span>
<span>  <span class="st">"E[2-3]"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">new_traj_ls</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] "B[1-2]" "I[2-3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] "C[1-2]" "C[2-3]" "I[2-3]"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] "E[2-3]"</span></span></code></pre></div>
<p>In any case, <code><a href="../reference/define_retra.html">define_retra()</a></code> will return the same
output</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define representative trajectories using a data frame</span></span>
<span><span class="va">new_repr_traj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_retra.html">define_retra</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_traj_df</span>, </span>
<span>             <span class="co"># Information of the state space</span></span>
<span>             d <span class="op">=</span> <span class="va">state_dissim</span>, trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>             <span class="co"># RETRA object returned by retra_edr()</span></span>
<span>             retra <span class="op">=</span> <span class="va">repr_traj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define representative trajectories using a list with sequences of segments</span></span>
<span><span class="va">new_repr_traj_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_retra.html">define_retra</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">new_traj_ls</span>, </span>
<span>             <span class="co"># Information of the state space</span></span>
<span>             d <span class="op">=</span> <span class="va">state_dissim</span>, trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, </span>
<span>             states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>             <span class="co"># RETRA object returned by retra_edr()</span></span>
<span>             retra <span class="op">=</span> <span class="va">repr_traj</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">new_repr_traj</span>, <span class="va">new_repr_traj_ls</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Yes, both are equal!"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; [1] "Yes, both are equal!"</span></span></code></pre></div>
<p><code><a href="../reference/define_retra.html">define_retra()</a></code> returns an object of class
<code>RETRA</code> that you can use to plot the new trajectories:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">new_repr_traj</span>, <span class="co"># &lt;-- This is the RETRA object returned by define_retra()</span></span>
<span>     <span class="co"># data to generate the state space</span></span>
<span>     d <span class="op">=</span> <span class="va">state_mds</span>, trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>     <span class="co"># display individual trajectories in light blue</span></span>
<span>     traj.colors <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>     <span class="co"># display representative trajectories in dark blue    </span></span>
<span>     RT.colors <span class="op">=</span> <span class="st">"darkblue"</span>,</span>
<span>     <span class="co"># select T1.2 to be displayed in a different color (red)</span></span>
<span>     select_RT <span class="op">=</span> <span class="st">"T1.2"</span>, sel.color <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     <span class="co"># Identify artificial links using dashed lines (default), but use the same </span></span>
<span>     <span class="co"># color than the representative trajectories (default)</span></span>
<span>     link.lty <span class="op">=</span> <span class="fl">2</span>, link.color <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>     <span class="co"># We can use other arguments in plot()</span></span>
<span>     main <span class="op">=</span> <span class="st">"Defined representative trajectories"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a legend </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1.1, T2.1"</span>, <span class="st">"T1.2"</span>, <span class="st">"Link"</span><span class="op">)</span>, </span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"darkblue"</span>, <span class="st">"red"</span>, <span class="st">"darkblue"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/plot_newretra-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="variation-of-ecological-properties-along-representative-trajectories">4.4. Variation of ecological properties along representative
trajectories<a class="anchor" aria-label="anchor" href="#variation-of-ecological-properties-along-representative-trajectories"></a>
</h3>
<p>The definition of representative trajectories is based on the real
states of the sampling units. Thus, it is possible to assess the
variation of some ecological properties along the representative
trajectories, and therefore, across the EDR.</p>
<p>Let’s see how species diversity varies along the representative
trajectories returned by <code><a href="../reference/retra_edr.html">retra_edr()</a></code>. First, we need to
calculate an index of species diversity (e.g., Shannon index) for the
states in each representative trajectory and set the order of the states
in the trajectory:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set an ID in the abundance matrix</span></span>
<span><span class="va">abundance</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">sampling_unit</span>, <span class="va">abundance</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the Shannon index in all trajectory states</span></span>
<span><span class="va">abundance</span><span class="op">$</span><span class="va">Shannon</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/diversity.html" class="external-link">diversity</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span><span class="op">)</span><span class="op">]</span>, index <span class="op">=</span> <span class="st">"shannon"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Identify the states forming both representative trajectories</span></span>
<span><span class="va">traj_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">repr_traj</span>, <span class="kw">function</span><span class="op">(</span><span class="va">iRT</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">segments</span> <span class="op">&lt;-</span> <span class="va">iRT</span><span class="op">$</span><span class="va">Segments</span></span>
<span>  <span class="va">seg_components</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\]"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\["</span>, <span class="st">"-"</span>, <span class="va">segments</span><span class="op">)</span><span class="op">)</span>, <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="va">traj_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">seg_components</span>, <span class="kw">function</span><span class="op">(</span><span class="va">iseg</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">iseg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">iseg</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">iseg</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">iseg</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">traj_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">traj_states</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">traj_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="va">traj_states</span>, RT_states <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">traj_states</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Associate the states of the representative trajectories with their corresponding</span></span>
<span><span class="co"># value of the Shannnon index</span></span>
<span><span class="va">RT_diversity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">traj_states</span>, <span class="kw">function</span><span class="op">(</span><span class="va">iRT</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">iRT</span>, <span class="va">abundance</span>, by <span class="op">=</span> <span class="st">"ID"</span>, all.x <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">RT_states</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">RT_diversity</span><span class="op">$</span><span class="va">T2</span></span>
<span><span class="co">#&gt;   ID RT_states sampling_unit time       sp1        sp2    Shannon</span></span>
<span><span class="co">#&gt; 1 C1         1             C    1 0.3761468 0.62385321 0.66214624</span></span>
<span><span class="co">#&gt; 2 C2         2             C    2 0.5930319 0.40696810 0.67573602</span></span>
<span><span class="co">#&gt; 3 C3         3             C    3 0.7754031 0.22459689 0.53266482</span></span>
<span><span class="co">#&gt; 6 I2         4             I    2 0.8009390 0.19906100 0.49909794</span></span>
<span><span class="co">#&gt; 7 I3         5             I    3 0.9044378 0.09556219 0.31522122</span></span>
<span><span class="co">#&gt; 4 E2         6             E    2 0.9574203 0.04257971 0.17605768</span></span>
<span><span class="co">#&gt; 5 E3         7             E    3 0.9809725 0.01902749 0.09422978</span></span></code></pre></div>
<p>Then, we can evaluate the variation of species diversity along the
representative trajectories graphically:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot the variation of species diversity in T1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RT_diversity</span><span class="op">$</span><span class="va">T1</span><span class="op">$</span><span class="va">RT_states</span> <span class="op">+</span> <span class="fl">1</span>, y <span class="op">=</span> <span class="va">RT_diversity</span><span class="op">$</span><span class="va">T1</span><span class="op">$</span><span class="va">Shannon</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">7</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.7</span><span class="op">)</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"RT state"</span>, ylab <span class="op">=</span> <span class="st">"Shannon index"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Variation of species diversity"</span><span class="op">)</span></span>
<span><span class="co"># Add the variation of species diversity in T2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">RT_diversity</span><span class="op">$</span><span class="va">T2</span><span class="op">$</span><span class="va">RT_states</span>, y <span class="op">=</span> <span class="va">RT_diversity</span><span class="op">$</span><span class="va">T2</span><span class="op">$</span><span class="va">Shannon</span>,</span>
<span>      col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="co"># Add a legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/plot_sp_diversity-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="distribution-and-heterogeneity-of-ecological-trajectories-in-edrs">5. Distribution and heterogeneity of ecological trajectories in
EDRs<a class="anchor" aria-label="anchor" href="#distribution-and-heterogeneity-of-ecological-trajectories-in-edrs"></a>
</h2>
<p>Representative trajectories aim to summarize the main dynamic
patterns of ecological systems in a given EDR. As a complement, you can
compute additional metrics to understand the internal structure of the
EDR.</p>
<div class="section level3">
<h3 id="dynamic-dispersion-ddis">5.1. Dynamic dispersion (dDis)<a class="anchor" aria-label="anchor" href="#dynamic-dispersion-ddis"></a>
</h3>
<p><strong>Dynamic dispersion (dDis)</strong> is calculated as the
average dissimilarity between the trajectories in an EDR and another
trajectory taken as a reference (Sánchez-Pinillos et al., 2023).</p>
<p>If the trajectory taken as the reference is one of the representative
trajectories (e.g. <em>T2</em>), <em>dDis</em> can be used as an
indicator of its fitness to the data and as an overall metric of the
dispersion of the trajectories in the EDR.</p>
<p>First, you need to prepare the data. Even if the states of the
representative trajectories are already in your abundance and
dissimilarity matrices, you will need to duplicate them to indicate that
this is a different trajectory. We can directly use the data frame that
we produced to calculate species diversity.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Change the trajectory identifier and the number of the state</span></span>
<span><span class="va">abundance_T2</span> <span class="op">&lt;-</span> <span class="va">RT_diversity</span><span class="op">$</span><span class="va">T2</span></span>
<span><span class="va">abundance_T2</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">&lt;-</span> <span class="st">"T2"</span></span>
<span><span class="va">abundance_T2</span><span class="op">$</span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">abundance_T2</span><span class="op">$</span><span class="va">RT_states</span></span>
<span></span>
<span><span class="co"># Add representative trajectories' data to the abundance matrix</span></span>
<span><span class="va">abundance_T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">abundance</span>, <span class="va">abundance_T2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate state dissimilarities including the representative trajectory</span></span>
<span><span class="va">state_dissim_T2</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">abundance_T2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sp1"</span>, <span class="st">"sp2"</span><span class="op">)</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span></code></pre></div>
<p>Now, we can compute dDis using <code><a href="../reference/EDR_metrics.html">dDis()</a></code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute dDis taking T2 as reference</span></span>
<span><span class="va">dDis_T2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EDR_metrics.html">dDis</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">state_dissim_T2</span>, d.type <span class="op">=</span> <span class="st">"dStates"</span>, </span>
<span>         trajectories <span class="op">=</span> <span class="va">abundance_T2</span><span class="op">$</span><span class="va">sampling_unit</span>, states <span class="op">=</span> <span class="va">abundance_T2</span><span class="op">$</span><span class="va">time</span>, </span>
<span>         reference <span class="op">=</span> <span class="st">"T2"</span><span class="op">)</span></span>
<span><span class="va">dDis_T2</span></span>
<span><span class="co">#&gt; dDis (ref. T2) </span></span>
<span><span class="co">#&gt;      0.1463935</span></span></code></pre></div>
<p>Instead of using the representative trajectory as the reference, we
could use any other trajectory of the EDR to quantify how “immersed” it
is in the EDR. Let’s compare <em>dDis</em> for trajectories of the
sampling units <em>I</em>, which is part of both representative
trajectories, and <em>F</em>, which was displayed relatively far from
the rest of trajectories in the state and trajectory spaces.</p>
<p>In this case, we will use the trajectory dissimilarity matrix
generated for the original data:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># dDis: reference C</span></span>
<span><span class="va">dDis_I</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EDR_metrics.html">dDis</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, </span>
<span>         trajectories <span class="op">=</span> <span class="va">ID_sampling</span>, </span>
<span>         reference <span class="op">=</span> <span class="st">"I"</span><span class="op">)</span></span>
<span><span class="co"># dDis: reference F</span></span>
<span><span class="va">dDis_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EDR_metrics.html">dDis</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, </span>
<span>         trajectories <span class="op">=</span> <span class="va">ID_sampling</span>, </span>
<span>         reference <span class="op">=</span> <span class="st">"F"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dDis_I</span></span>
<span><span class="co">#&gt; dDis (ref. I) </span></span>
<span><span class="co">#&gt;     0.1847822</span></span>
<span><span class="va">dDis_F</span></span>
<span><span class="co">#&gt; dDis (ref. F) </span></span>
<span><span class="co">#&gt;     0.5809146</span></span></code></pre></div>
<p>As expected, the dispersion when trajectory <em>F</em> is taken as
the reference is larger than for trajectory <em>I</em>, indicating that
<em>F</em> is more isolated than <em>I</em> within the EDR.</p>
<p>Alternatively, you can weight each trajectory depending on some
criteria. Currently, <code><a href="../reference/EDR_metrics.html">dDis()</a></code> is able to compute
<em>dDis</em> weighting ecological trajectories by their size
(<code>w.type = "size"</code>) and length
(<code>w.type = "length"</code>). However, if you want to use different
criteria, you can use a set of weights of your choice
(<code>w.type = "precomputed"</code>) and indicate them through the
<code>w.values</code> argument. For example, imagine that you want to
weight each trajectory by the initial abundance of <em>sp2</em>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define w values</span></span>
<span><span class="va">initial_sp2</span> <span class="op">&lt;-</span> <span class="va">abundance</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">abundance</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="op">]</span><span class="op">$</span><span class="va">sp2</span></span>
<span></span>
<span><span class="co"># Identify the index of the reference trajectories</span></span>
<span><span class="va">ind_I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ID_sampling</span> <span class="op">==</span> <span class="st">"I"</span><span class="op">)</span></span>
<span><span class="va">ind_F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">ID_sampling</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compute dDis with weighted trajectories:</span></span>
<span><span class="co"># Considering I as reference</span></span>
<span><span class="va">dDis_I_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EDR_metrics.html">dDis</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, </span>
<span>         trajectories <span class="op">=</span> <span class="va">ID_sampling</span>, reference <span class="op">=</span> <span class="st">"I"</span>, </span>
<span>         w.type <span class="op">=</span> <span class="st">"precomputed"</span>, w.values <span class="op">=</span> <span class="va">initial_sp2</span><span class="op">[</span><span class="op">-</span><span class="va">ind_I</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Considering F as reference</span></span>
<span><span class="va">dDis_F_w</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/EDR_metrics.html">dDis</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, </span>
<span>         trajectories <span class="op">=</span> <span class="va">ID_sampling</span>, reference <span class="op">=</span> <span class="st">"F"</span>, </span>
<span>         w.type <span class="op">=</span> <span class="st">"precomputed"</span>, w.values <span class="op">=</span> <span class="va">initial_sp2</span><span class="op">[</span><span class="op">-</span><span class="va">ind_F</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">dDis_I_w</span></span>
<span><span class="co">#&gt; dDis (ref. I) </span></span>
<span><span class="co">#&gt;     0.2517555</span></span>
<span><span class="va">dDis_F_w</span></span>
<span><span class="co">#&gt; dDis (ref. F) </span></span>
<span><span class="co">#&gt;     0.4742493</span></span></code></pre></div>
<p>In comparison with the previous results, <em>dDis</em> has increased
and decreased for <em>I</em> and <em>F</em>, respectively, as a result
of the greater abundance of <em>sp2</em> in <em>F</em> than in
<em>I</em>. This result could be interpreted as a lower isolation of
<em>F</em> in relation to the trajectories initially dominated by
<em>sp2</em>.</p>
<p>Weighting ecological trajectories is equivalent to modifying the
location of the trajectory taken as the reference. Therefore, I do not
recommend you to weight trajectories if the representative trajectory is
the reference of <em>dDis</em> because it could make difficult the
interpretation of the results.</p>
</div>
<div class="section level3">
<h3 id="dynamic-beta-diversity-dbd">5.2. Dynamic beta diversity (dBD)<a class="anchor" aria-label="anchor" href="#dynamic-beta-diversity-dbd"></a>
</h3>
<p><strong>Dynamic beta diversity (dBD)</strong> was proposed by De
Cáceres et al. (2019; <em>Ecol. Monogr.</em>, <a href="https://doi.org/10.1002/ecm.1350" class="external-link uri">https://doi.org/10.1002/ecm.1350</a>) to quantify the
overall variability of a group of trajectories. Conceptually, it
measures the average distance to the centroid of the trajectories.
Therefore, it is quite similar to <em>dDis</em> when it is calculated
taking a representative trajectory as the reference.</p>
<p><em>dBD</em> is implemented in the function <code><a href="../reference/EDR_metrics.html">dBD()</a></code>. As
you can imagine, <em>dBD</em> in our EDR is very small because the
dynamical patterns of all trajectories are very similar.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate dBD</span></span>
<span><span class="fu"><a href="../reference/EDR_metrics.html">dBD</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">state_dissim</span>, d.type <span class="op">=</span> <span class="st">"dStates"</span>, </span>
<span>    trajectories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_sampling</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">ID_obs</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;        dBD </span></span>
<span><span class="co">#&gt; 0.06252172</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dynamic-evenness-deve">5.3. Dynamic evenness (dEve)<a class="anchor" aria-label="anchor" href="#dynamic-evenness-deve"></a>
</h3>
<p><strong>Dynamic evenness (dEve)</strong> quantifies the regularity
with which an EDR is filled by ecological trajectories (Sánchez-Pinillos
et al., 2023). This metric informs about the existence of groups of
trajectories within the EDR.</p>
<p>You can compute <em>dEve</em> with the function
<code><a href="../reference/EDR_metrics.html">dEve()</a></code>:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate dEve</span></span>
<span><span class="fu"><a href="../reference/EDR_metrics.html">dEve</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, trajectories <span class="op">=</span> <span class="va">ID_sampling</span><span class="op">)</span></span>
<span><span class="co">#&gt;      dEve </span></span>
<span><span class="co">#&gt; 0.5827095</span></span></code></pre></div>
<p>Like <em>dDis</em>, <em>dEve</em> can also be calculated using
different weights for the individual trajectories of the EDR. In that
case, <em>dEve</em> is equivalent to the functional evenness index
proposed by Villéger et al. (2003; <em>Ecology</em>, <a href="https://doi.org/10.1890/07-1206.1" class="external-link uri">https://doi.org/10.1890/07-1206.1</a>).</p>
<p>For example, weighting ecological trajectories by the initial
abundance of <em>sp2</em> is equivalent to reducing the dissimilarity of
the trajectories dominated by <em>sp2</em> and <em>dEve</em>
increases.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Calculate dEve weighting trajectories by the initial abundance of sp2</span></span>
<span><span class="fu"><a href="../reference/EDR_metrics.html">dEve</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>, trajectories <span class="op">=</span> <span class="va">ID_sampling</span>,</span>
<span>         w.type <span class="op">=</span> <span class="st">"precomputed"</span>, w.values <span class="op">=</span> <span class="va">initial_sp2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      dEve </span></span>
<span><span class="co">#&gt; 0.6296034</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="comparing-edrs">6. Comparing EDRs<a class="anchor" aria-label="anchor" href="#comparing-edrs"></a>
</h2>
<p>Representative trajectories and the metrics of dynamic dispersion,
beta diversity, and evenness will allow you to characterize EDRs based
on their dynamic patterns and the distribution of ecological
trajectories. Therefore, you can compare two or more EDRs based on these
features, saying “this EDR is dominated by these dynamics, whereas the
dynamics in this other EDR are different” or “the trajectories in this
EDR are more diverse than in this other EDR”. But what if you want to
quantify how different two EDRs are? This is a common situation.
Perhaps, you want to compare EDRs of ecosystems under different
environmental conditions, for example, forest communities dominated by
the same species that grow under different climatic conditions. Perhaps,
you want to use simulated data to assess the effects of the introduction
of certain species in the EDRs.</p>
<p>Of course, comparing EDR characteristics will provide you with very
valuable information, but if you want “a number”, you will have to
calculate the <strong>dissimilarities between EDRs</strong>. You can do
it using <code>ecoregime</code>.</p>
<p>Let’s generate two more EDRs to be compared with the previous
one.</p>
<p>We will use the initial states of our first EDR to define the
abundances of <em>sp1</em> and <em>sp2</em>, but we will introduce a
third species (<em>sp3</em>).</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ID of the sampling units for EDR2</span></span>
<span><span class="va">ID_sampling2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"inv_"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define initial species abundances for sp3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span>
<span><span class="va">initial</span><span class="op">$</span><span class="va">sp3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the parameters for the Lotka-Volterra model</span></span>
<span><span class="va">parms2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r1 <span class="op">=</span> <span class="fl">1</span>, r2 <span class="op">=</span> <span class="fl">0.1</span>, a11 <span class="op">=</span> <span class="fl">0.02</span>, a21 <span class="op">=</span> <span class="fl">0.03</span>, a22 <span class="op">=</span> <span class="fl">0.02</span>, a12 <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>           r3 <span class="op">=</span> <span class="fl">1.5</span>, a33 <span class="op">=</span> <span class="fl">0.02</span>, a31 <span class="op">=</span> <span class="fl">0.01</span>, a32 <span class="op">=</span> <span class="fl">0.01</span>, a13 <span class="op">=</span> <span class="fl">0.1</span>, a23 <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can use primer to run the simulations</span></span>
<span><span class="va">simulated_abun2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">initial</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">isampling</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Initial abundance in the sampling unit i</span></span>
<span>  <span class="va">initialN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial</span><span class="op">$</span><span class="va">sp1</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, <span class="va">initial</span><span class="op">$</span><span class="va">sp2</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, <span class="va">initial</span><span class="op">$</span><span class="va">sp3</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Simulate community dynamics</span></span>
<span>  <span class="va">simulated_abun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">initialN</span>, times <span class="op">=</span> <span class="va">ID_obs</span>, func <span class="op">=</span> <span class="va">lvcomp3</span>, parms <span class="op">=</span> <span class="va">parms2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Add the names of the sampling units</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">&lt;-</span> <span class="va">ID_sampling2</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span></span>
<span>  <span class="co"># Calculate relative abundances</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp3</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X3</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span>, <span class="st">"X3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sampling_unit"</span>, <span class="st">"time"</span>, <span class="st">"sp1"</span>, <span class="st">"sp2"</span>, <span class="st">"sp3"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile species abundances of all sampling units in the same data frame</span></span>
<span><span class="va">abundance2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulated_abun2</span><span class="op">)</span></span></code></pre></div>
<p>The third EDR will be composed of trajectories dominated by
<em>sp2</em> and a new species (<em>sp4</em>) able to coexist in
equilibrium with <em>sp2</em>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ID of the sampling units for EDR3</span></span>
<span><span class="va">ID_sampling3</span> <span class="op">&lt;-</span> <span class="va">LETTERS</span><span class="op">[</span><span class="fl">11</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Define initial species abundances</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">initial3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>sampling_units <span class="op">=</span> <span class="va">ID_sampling3</span>, </span>
<span>                   sp4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the parameters for the Lotka-Volterra model</span></span>
<span><span class="va">parms3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>r1 <span class="op">=</span> <span class="fl">1</span>, r2 <span class="op">=</span> <span class="fl">0.1</span>, a11 <span class="op">=</span> <span class="fl">0.2</span>, a21 <span class="op">=</span> <span class="fl">0.1</span>, a22 <span class="op">=</span> <span class="fl">0.02</span>, a12 <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># We can use primer to run the simulations</span></span>
<span><span class="va">simulated_abun3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">initial</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">isampling</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="co"># Initial abundance in the sampling unit i</span></span>
<span>  <span class="va">initialN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">initial3</span><span class="op">$</span><span class="va">sp4</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, <span class="va">initial</span><span class="op">$</span><span class="va">sp2</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="co"># Simulate community dynamics</span></span>
<span>  <span class="va">simulated_abun</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">initialN</span>, times <span class="op">=</span> <span class="va">ID_obs</span>, func <span class="op">=</span> <span class="va">lvcomp2</span>, parms <span class="op">=</span> <span class="va">parms3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># Add the names of the sampling units</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sampling_unit</span> <span class="op">&lt;-</span> <span class="va">ID_sampling3</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span></span>
<span>  <span class="co"># Calculate relative abundances</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp4</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">simulated_abun</span><span class="op">$</span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="va">simulated_abun</span><span class="op">$</span><span class="va">X2</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X1"</span>, <span class="st">"X2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">simulated_abun</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sampling_unit"</span>, <span class="st">"time"</span>, <span class="st">"sp4"</span>, <span class="st">"sp2"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile species abundances of all sampling units in the same data frame</span></span>
<span><span class="va">abundance3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">simulated_abun3</span><span class="op">)</span></span></code></pre></div>
<p>Once we have species abundances for all EDRs, we need to calculate
trajectory dissimilarities:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Bind all abundance matrices</span></span>
<span><span class="va">abundance_allEDR</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">abundance</span>, <span class="va">abundance2</span>, <span class="va">abundance3</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">abundance_allEDR</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">abundance_allEDR</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co"># Calculate state dissimilarities including states in the three EDRs</span></span>
<span><span class="va">state_dissim_allEDR</span> <span class="op">&lt;-</span> <span class="fu">vegan</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/vegan/man/vegdist.html" class="external-link">vegdist</a></span><span class="op">(</span><span class="va">abundance_allEDR</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                                      method <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate trajectory dissimilarities including trajectories in the three EDRs</span></span>
<span><span class="va">traj_dissim_allEDR</span> <span class="op">&lt;-</span> <span class="fu">ecotraj</span><span class="fu">::</span><span class="fu"><a href="https://emf-creaf.github.io/ecotraj/reference/trajectorymetrics.html" class="external-link">trajectoryDistances</a></span><span class="op">(</span><span class="va">state_dissim_allEDR</span>, </span>
<span>                                                   sites <span class="op">=</span> <span class="va">abundance_allEDR</span><span class="op">$</span><span class="va">sampling_unit</span>,</span>
<span>                                                   surveys <span class="op">=</span> <span class="va">abundance_allEDR</span><span class="op">$</span><span class="va">time</span><span class="op">)</span></span></code></pre></div>
<p>If we plot the trajectories of all EDRs in a common state space, we
can see that <em>EDR2</em> is closer to <em>EDR1</em> than
<em>EDR3</em>. This is not surprising since all the species in
<em>EDR1</em> are present in <em>EDR2</em>. In contrast, <em>EDR3</em>
only has one species in common with the other EDRs.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Multidimensional scaling</span></span>
<span><span class="va">st_mds_all</span> <span class="op">&lt;-</span> <span class="fu">smacof</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/smacof/man/smacofSym.html" class="external-link">smacofSym</a></span><span class="op">(</span><span class="va">state_dissim_allEDR</span>, </span>
<span>                                  ndim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">state_dissim_allEDR</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">st_mds_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">st_mds_all</span><span class="op">$</span><span class="va">conf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot ecological trajectories in the state space</span></span>
<span><span class="va">state.colorsEDRs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">RColorBrewer</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/RColorBrewer/man/ColorBrewer.html" class="external-link">brewer.pal</a></span><span class="op">(</span><span class="fl">3</span>, <span class="st">"Set1"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="co"># Set an empty plot</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">st_mds_all</span><span class="op">$</span><span class="va">D1</span>, <span class="va">st_mds_all</span><span class="op">$</span><span class="va">D2</span>, type <span class="op">=</span> <span class="st">"n"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Axis 1"</span>, ylab <span class="op">=</span> <span class="st">"Axis 2"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"EDRs in the state space"</span><span class="op">)</span></span>
<span><span class="co"># Add arrows</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">isampling</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">90</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># From observation 1 to observation 2</span></span>
<span>  <span class="fu">shape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shape/man/Arrows.html" class="external-link">Arrows</a></span><span class="op">(</span><span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         col <span class="op">=</span> <span class="va">state.colorsEDRs</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, arr.adj <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="co"># From observation 2 to observation 3</span></span>
<span>  <span class="fu">shape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shape/man/Arrows.html" class="external-link">Arrows</a></span><span class="op">(</span><span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">st_mds_all</span><span class="op">[</span><span class="va">isampling</span> <span class="op">+</span> <span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>         col <span class="op">=</span> <span class="va">state.colorsEDRs</span><span class="op">[</span><span class="va">isampling</span><span class="op">]</span>, arr.adj <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add a legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"EDR"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">state.colorsEDRs</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="EDR_framework_files/figure-html/state_mds_allEDR-1.png" width="480" style="display: block; margin: auto;"></p>
<p>Let’s see how this is reflected in a dissimilarity matrix generated
with <code><a href="../reference/dist_edr.html">dist_edr()</a></code>:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Compute the dissimilarities between EDRs</span></span>
<span><span class="va">EDR_dissim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dist_edr.html">dist_edr</a></span><span class="op">(</span>d <span class="op">=</span> <span class="va">traj_dissim_allEDR</span>, d.type <span class="op">=</span> <span class="st">"dTraj"</span>,</span>
<span>                       edr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"EDR1"</span>, <span class="st">"EDR2"</span>, <span class="st">"EDR3"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, </span>
<span>                       metric <span class="op">=</span> <span class="st">"dDR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">EDR_dissim</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;      EDR1 EDR2 EDR3</span></span>
<span><span class="co">#&gt; EDR1 0.00 0.25 0.73</span></span>
<span><span class="co">#&gt; EDR2 0.39 0.00 0.82</span></span>
<span><span class="co">#&gt; EDR3 0.67 0.71 0.00</span></span></code></pre></div>
<p>As expected, the dissimilarity values between <em>EDR1</em> and
<em>EDR2</em> are smaller than the dissimilarities between <em>EDR3</em>
and both, <em>EDR1</em> and <em>EDR2</em>.</p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>This project has received funding from the European Union’s Horizon
2020 research and innovation program under the Marie Sklodowska-Curie
grant agreement No 891477 (RESET project).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Martina Sánchez-Pinillos.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
